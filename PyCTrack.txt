import csv
from datetime import datetime
import matplotlib.pyplot as plt

# File where we store expenses and income
FILENAME = "finance_data.csv"

# Function to add a new transaction
def add_transaction():
    date = input("Enter date (YYYY-MM-DD): ")
    category = input("Enter category (e.g., Food, Rent, Salary): ")
    amount = float(input("Enter amount (use negative for expense): "))
    
    # Save the transaction to CSV
    with open(FILENAME, mode='a', newline='') as file:
        writer = csv.writer(file)
        writer.writerow([date, category, amount])
    
    print("Transaction added successfully!")

# Function to read all transactions
def read_transactions():
    transactions = []
    try:
        with open(FILENAME, mode='r') as file:
            reader = csv.reader(file)
            for row in reader:
                date, category, amount = row
                transactions.append((date, category, float(amount)))
    except FileNotFoundError:
        # If file doesn't exist yet, return empty list
        return []
    return transactions

# Function to show summary of income and expenses
def show_summary(transactions):
    total_income = sum(amount for _, _, amount in transactions if amount > 0)
    total_expense = sum(-amount for _, _, amount in transactions if amount < 0)
    balance = total_income - total_expense
    
    print(f"\nTotal Income: ${total_income:.2f}")
    print(f"Total Expense: ${total_expense:.2f}")
    print(f"Balance: ${balance:.2f}\n")

# Function to visualize spending by category
def plot_expenses(transactions):
    category_totals = {}
    for _, category, amount in transactions:
        if amount < 0:
            category_totals[category] = category_totals.get(category, 0) + -amount
    
    if not category_totals:
        print("No expenses to show.")
        return
    
    # Plotting
    categories = list(category_totals.keys())
    totals = list(category_totals.values())
    
    plt.figure(figsize=(8, 5))
    plt.bar(categories, totals, color='skyblue')
    plt.title("Expenses by Category")
    plt.ylabel("Amount ($)")
    plt.show()

# Main program loop
def main():
    while True:
        print("\n--- Personal Finance Tracker ---")
        print("1. Add transaction")
        print("2. Show summary")
        print("3. Show expenses chart")
        print("4. Exit")
        choice = input("Choose an option: ")
        
        transactions = read_transactions()
        
        if choice == "1":
            add_transaction()
        elif choice == "2":
            show_summary(transactions)
        elif choice == "3":
            plot_expenses(transactions)
        elif choice == "4":
            print("Goodbye!")
            break
        else:
            print("Invalid choice, try again.")

if __name__ == "__main__":
    main()
